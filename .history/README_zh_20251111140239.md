# AI心理学家 - 拥有长期记忆的共情心理健康聊天机器人

## 项目概述

AI心理学家是一个智能心理健康助手，提供个性化的心理咨询服 务，具备长期记忆能力。系统将记住用户的心理档案、偏好和咨询历史，以提供持续且量身定制的支持。

## 功能特性

- **多层次记忆系统**：实现工作记忆、情景记忆、语义记忆和外部持久记忆
- **共情对话**：使用三阶段共情模型（情绪识别、共情表达、策略性支持）
- **隐私保护**：所有数据本地存储，无外部传输
- **成本效益**：利用OpenRouter免费层模型
- **可定制人格**：AI心理学家的多种人格选项

## 项目结构

```
AI_psychologist/
├── src/
│   ├── __init__.py
│   ├── main.py              # 主入口点
│   ├── ai_psychologist.py   # 核心AI心理学家实现
│   └── config.py            # 配置设置
├── data/                    # 用户数据存储（首次运行时创建）
├── vector_db/               # 语义记忆的向量数据库（首次运行时创建）
├── requirements.txt         # Python依赖
├── .env.example             # 环境变量示例
├── README.md               # 英文说明文档
├── README_zh.md            # 本中文说明文档
├── requirements_zh.md       # 中文需求文档
├── proposal.txt            # 项目提案
└── 技术参考.txt             # 技术参考文档
```

## 安装说明

### 环境要求

- Python 3.8 或更高版本
- pip (Python包管理器)

### 安装步骤

1. **克隆或下载代码库**
   ```bash
   git clone <repository-url>
   cd AI_psychologist
   ```

2. **创建虚拟环境（推荐）**
   ```bash
   python -m venv venv
   # Windows系统
   venv\Scripts\activate
   # macOS/Linux系统
   source venv/bin/activate
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **设置环境变量**
   复制示例环境文件并编辑以添加您的OpenRouter API密钥：
   ```bash
   cp .env.example .env
   ```
   然后编辑`.env`文件，添加您的OpenRouter API密钥：
   ```
   OPENROUTER_API_KEY=your_actual_api_key_here
   ```

## 使用方法

### 运行应用程序

启动与AI心理学家的对话：
```bash
python src/main.py
```

指定用户ID（用于维护独立的记忆档案）：
```bash
python src/main.py --user-id your_user_id
```

重置用户的记忆：
```bash
python src/main.py --user-id your_user_id --reset-memory
```

### 对话过程中

- 像与心理学家对话一样自然地输入消息
- 系统将记住您对话中的重要信息
- 输入`quit`、`exit`或`bye`结束会话

## 配置说明

应用程序可以通过`.env`文件中的环境变量进行配置：

- `OPENROUTER_API_KEY`：您的OpenRouter API密钥（获取真实AI响应所需）
- `DATA_STORAGE_PATH`：用户数据存储路径（默认：`./data`）
- `VECTOR_DB_PATH`：向量数据库存储路径（默认：`./vector_db`）
- `DEFAULT_MODEL`：默认使用的模型（默认：`openrouter/auto`）
- `WORKING_MEMORY_SIZE`：工作记忆中保留的最近消息数量（默认：`10`）
- `EPISODIC_MEMORY_LIMIT`：存储的情景记忆最大数量（默认：`100`）

## 记忆系统实现

AI心理学家实现了基于人类记忆模型的五层记忆系统：

1. **工作记忆**：短期对话上下文（最近N条消息）
2. **情景记忆**：带时间戳的事件和对话历史
3. **语义记忆**：事实、知识和用户档案
4. **程序性记忆**：咨询技巧和技能
5. **外部持久记忆**：超越会话上下文的长期存储

## 技术实现细节

### 记忆层实现

#### 工作记忆 (Working Memory)
- 实现为最近对话消息的缓冲区
- 默认保留最近10条消息
- 在每次对话中作为上下文传递给AI模型

#### 情景记忆 (Episodic Memory)
- 存储带时间戳的用户交互和事件记录
- 使用JSON文件进行持久化存储
- 集成向量数据库(ChromaDB)进行语义搜索

#### 语义记忆 (Semantic Memory)
- 存储与时间无关的知识、事实和用户档案
- 使用向量数据库存储用户偏好和事实
- 支持基于语义相似性的记忆检索

#### 程序性记忆 (Procedural Memory)
- 存储咨询技巧、技能和案例参考
- 实现为动态Few-shot示例库
- 为大模型提供操作参考

#### 外部持久记忆 (External Persistent Memory)
- 超出会话上下文的长期存储
- 使用向量库和分层存储实现
- 记录高频事实和新颖事实

### 共情模型实现

采用三阶段共情模型：

1. **情绪识别**：从用户输入中检测情绪状态
2. **共情表达**：生成理解和验证性回应
3. **策略性支持**：提供适当的应对策略和资源

### 上下文构建

在每次用户输入时，系统会：

1. 从工作记忆中获取最近的对话上下文
2. 从情景记忆中检索相关的历史对话
3. 从语义记忆中获取用户档案信息
4. 构建完整的上下文传递给AI模型

## 开发说明

### 运行演示

应用程序包含一个无需API密钥的演示模式。当未提供API密钥时，系统将使用基于关键词检测的模拟响应。

### 功能扩展

可扩展的关键领域：
- 使用NLP库增强情绪检测
- 集成更复杂的心理学知识库
- 实现特定的治疗技术（CBT、DBT等）
- 开发Web界面
- 实现语音交互功能

## 依赖说明

- `openai`：用于OpenRouter API集成
- `chromadb`：语义记忆的向量数据库
- `numpy`：数值计算
- `sentence-transformers`：生成嵌入向量
- `python-dotenv`：环境变量管理
- `tqdm`：进度条

## 隐私与安全

- 所有数据都存储在用户的本地设备上
- 不向外部服务器传输个人信息
- 用户数据以纯JSON文件形式存储在`data/`目录中
- 可手动删除记忆文件以实现完全数据清除

## 故障排除

### 常见问题

1. **API密钥错误**：确保在`.env`文件中有有效的OpenRouter API密钥
2. **导入错误**：使用`pip install -r requirements.txt`确保所有依赖已安装
3. **内存问题**：如果遇到内存问题，请尝试使用`--reset-memory`标志重置用户记忆

### 获取帮助

如果遇到此README中未涵盖的问题，请查看问题跟踪器或联系开发团队。

## 许可证

本项目仅供教育和研究目的。不应替代专业的心理健康服务。

## 免责声明

此AI心理学家不是持牌治疗师，不应作为专业心理健康护理的替代品。如果您正在经历心理健康紧急情况，请立即联系紧急服务或危机热线。